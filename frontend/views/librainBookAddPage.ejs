<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
	<body>
		<h2>Add book</h2>
		<div id="statusBar"></div>
		<form id="myForm">
			<label for="title">title:</label>
			<input type="text" id="title" name="title" required />

			<label for="author">author:</label>
			<input type="author" id="author" name="author" required />

			<input type="submit" value="submit" id="submitButton" />
		</form>
	</body>
	<script>
		const backendUrl = "<%=backend%>";
		let storageToken = window.localStorage.getItem("token");
		if (!window.localStorage.getItem("token")) {
			window.location.href = "/";
		}
		storageToken = JSON.parse(storageToken);
		document
			.getElementById("myForm")
			.addEventListener("submit", function (event) {
				event.preventDefault();
				const submitButton = document.getElementById("submitButton");
				submitButton.disabled = true;
				const formData = new FormData(this);
				const data = {
					title: formData.get("title"),
					author: formData.get("author"),
				};
				const statusBar = document.getElementById("statusBar");
				statusBar.innerHTML = "request is on its way";
				fetch(backendUrl + "/librain/book", {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
						Authorization: `Bearer ${storageToken}`,
					},
					body: JSON.stringify(data),
				})
					.then((res) => {
						if (!res.ok) {
							const err = new Error();
							err.message = res.body.message || "something went wrong";
							err.status = res.status;
							throw err;
						}
						window.location.href = "/librain/book";
					})
					.catch((err) => {
						statusBar.innerHTML = `${err.status} ${err.message}`;
					});
			});
	</script>
</html>
